<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 VA Advanced Calculator</title>
    <style>
        :root { --primary: #003087; --secondary: #005ea2; --accent: #e1f3f8; --text: #333; --bilateral: #1a73e8; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #f0f2f5; color: var(--text); }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 5px; font-size: 1.8rem; }
        .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 25px; }

        /* Grids */
        .section-title { font-weight: 700; color: var(--secondary); margin-bottom: 10px; display: block; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
        .body-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .percent-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 25px; }
        
        /* Buttons */
        .btn-body, .btn-percent { padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; font-size: 1rem; font-weight: 600; color: #555; transition: all 0.2s; }
        .btn-percent { padding: 12px 0; font-size: 0.95rem; }
        .btn-body:hover, .btn-percent:hover { border-color: var(--secondary); background: #f9f9f9; }
        .selected { background: var(--secondary) !important; color: white !important; border-color: var(--primary) !important; }
        .full-width { grid-column: span 2; }

        /* Add Button */
        .btn-add { width: 100%; background: #2e8540; color: white; border: none; padding: 16px; font-size: 1.1rem; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 20px; opacity: 0.5; pointer-events: none; transition: opacity 0.2s; }
        .btn-add.active { opacity: 1; pointer-events: auto; }

        /* Results & Breakdown */
        .result-box { background: var(--primary); color: white; border-radius: 8px; padding: 25px; text-align: center; margin-bottom: 20px; }
        .big-rate { font-size: 3.5rem; font-weight: 800; line-height: 1; margin: 10px 0; }
        .sub-rate { font-size: 1.1rem; color: #ffd700; font-weight: bold; margin-bottom: 5px; }
        
        .bilateral-box { background: #e8f0fe; border-left: 5px solid var(--bilateral); padding: 15px; margin-bottom: 20px; border-radius: 4px; display: none; }
        .bilateral-title { color: var(--bilateral); font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; gap: 5px; }
        .math-step { font-size: 0.9rem; margin-bottom: 4px; color: #444; }

        /* List & Footer */
        .list-container { background: #f8f9fa; border-radius: 8px; border: 1px solid #eee; margin-bottom: 20px; }
        .list-item { display: flex; justify-content: space-between; padding: 12px 15px; border-bottom: 1px solid #e0e0e0; font-size: 0.95rem; }
        .delete-btn { color: #d93025; cursor: pointer; font-weight: bold; padding-left: 10px; }
        
        .disclaimer { font-size: 0.75rem; color: #777; text-align: center; margin-top: 30px; line-height: 1.4; border-top: 1px solid #ddd; padding-top: 15px; }

        /* Settings */
        .settings { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding-top: 10px; border-top: 1px solid #eee; margin-bottom: 20px; }
        select, input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
    </style>
</head>
<body>

<div class="card">
    <h1>ðŸ‡ºðŸ‡¸ VA Rating Calculator</h1>
    <div class="subtitle">2026 Rates â€¢ Live Bilateral Math</div>

    <label class="section-title">1. Choose Body Area</label>
    <div class="body-grid">
        <button class="btn-body" onclick="setPart('Left Arm', 'upper', this)">Left Arm</button>
        <button class="btn-body" onclick="setPart('Right Arm', 'upper', this)">Right Arm</button>
        <button class="btn-body" onclick="setPart('Left Leg', 'lower', this)">Left Leg</button>
        <button class="btn-body" onclick="setPart('Right Leg', 'lower', this)">Right Leg</button>
        <button class="btn-body full-width" onclick="setPart('Other / Systemic', 'other', this)">Other (Head, Back, Organs)</button>
    </div>

    <label class="section-title">2. Choose Rating %</label>
    <div class="percent-grid">
        <button class="btn-percent" onclick="setPercent(0, this)">0%</button>
        <button class="btn-percent" onclick="setPercent(10, this)">10%</button>
        <button class="btn-percent" onclick="setPercent(20, this)">20%</button>
        <button class="btn-percent" onclick="setPercent(30, this)">30%</button>
        <button class="btn-percent" onclick="setPercent(40, this)">40%</button>
        <button class="btn-percent" onclick="setPercent(50, this)">50%</button>
        <button class="btn-percent" onclick="setPercent(60, this)">60%</button>
        <button class="btn-percent" onclick="setPercent(70, this)">70%</button>
        <button class="btn-percent" onclick="setPercent(80, this)">80%</button>
        <button class="btn-percent" onclick="setPercent(90, this)">90%</button>
        <button class="btn-percent" onclick="setPercent(100, this)">100%</button>
    </div>

    <button id="addBtn" class="btn-add" onclick="addItem()">+ Add Disability</button>

    <div class="result-box">
        <div class="details">Combined Rating (Rounded)</div>
        <div class="big-rate" id="finalRating">0%</div>
        <div class="sub-rate" id="rawRating">Exact Raw Score: 0%</div>
        <div class="pay-rate" id="monthlyPay">$0.00 / mo</div>
    </div>

    <div class="bilateral-box" id="bilateralBox">
        <div class="bilateral-title">âš¡ Bilateral Factor Applied</div>
        <div id="bilateralMath"></div>
    </div>

    <div class="list-container" id="listContainer" style="display:none;"></div>

    <div class="settings">
        <div>
            <label>Marital Status</label>
            <select id="status" onchange="calculate()">
                <option value="single">Veteran Alone</option>
                <option value="spouse">Married</option>
            </select>
        </div>
        <div>
            <label>Children (< 18)</label>
            <select id="children" onchange="calculate()">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
</select>

        </div>
    </div>

    <div class="disclaimer">
        <strong>Educational Use Disclaimer:</strong> This tool is for educational purposes only and does not provide legal, medical, or official VA advice. Results are estimates and may differ from actual VA decisions.
    </div>
</div>

<script>
    let items = [];
    let currentSelection = { name: null, type: null, value: null };

    // 2026 Estimated Rates (2.8% COLA)
    const rates = {
        base: { 10: 180.42, 20: 356.66, 30: 552.47, 40: 795.84, 50: 1132.90, 60: 1435.02, 70: 1808.45, 80: 2102.15, 90: 2362.30, 100: 3938.58 },
        spouse: { 30: 65, 40: 87, 50: 109, 60: 131, 70: 153, 80: 175, 90: 197, 100: 219.59 },
        child: { 30: 44, 40: 58, 50: 73, 60: 88, 70: 102, 80: 117, 90: 132, 100: 146.85 }
    };

    function setPart(name, type, btn) {
        currentSelection.name = name;
        currentSelection.type = type;
        document.querySelectorAll('.btn-body').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        checkReady();
    }

    function setPercent(val, btn) {
        currentSelection.value = val;
        document.querySelectorAll('.btn-percent').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        checkReady();
    }

    function checkReady() {
        const btn = document.getElementById('addBtn');
        if (currentSelection.name && currentSelection.value !== null) {
            btn.classList.add('active');
            btn.innerHTML = `+ Add ${currentSelection.value}% (${currentSelection.name})`;
        }
    }

    function addItem() {
        if (!currentSelection.name) return;
        items.push({ ...currentSelection });
        currentSelection = { name: null, type: null, value: null };
        document.querySelectorAll('.selected').forEach(b => b.classList.remove('selected'));
        const btn = document.getElementById('addBtn');
        btn.classList.remove('active');
        btn.innerHTML = "+ Add Disability";
        renderList();
        calculate();
    }

    function deleteItem(index) {
        items.splice(index, 1);
        renderList();
        calculate();
    }

    function renderList() {
        const list = document.getElementById('listContainer');
        list.style.display = items.length ? 'block' : 'none';
        list.innerHTML = '';
        items.forEach((item, index) => {
            list.innerHTML += `<div class="list-item"><span>${item.name}: <strong>${item.value}%</strong></span> <span class="delete-btn" onclick="deleteItem(${index})">&times;</span></div>`;
        });
    }

    // VA Math Engine
    function vaCombine(ratings) {
        ratings.sort((a,b) => b-a);
        let efficiency = 100;
        ratings.forEach(r => {
            efficiency = efficiency * ((100 - r) / 100);
        });
        return 100 - efficiency;
    }

    function calculate() {
        // 1. Filter Bilateral Groups
        const upperItems = items.filter(i => i.type === 'upper');
        const lowerItems = items.filter(i => i.type === 'lower');
        const hasUpperPair = upperItems.some(i => i.name.includes('Left')) && upperItems.some(i => i.name.includes('Right'));
        const hasLowerPair = lowerItems.some(i => i.name.includes('Left')) && lowerItems.some(i => i.name.includes('Right'));

        let bilateralRatings = [];
        let standardRatings = [];

        items.forEach(item => {
            if ((item.type === 'upper' && hasUpperPair) || (item.type === 'lower' && hasLowerPair)) {
                bilateralRatings.push(item.value);
            } else {
                standardRatings.push(item.value);
            }
        });

        // 2. Calculate Bilateral Logic
        let rawScore = 0;
        const biBox = document.getElementById('bilateralBox');
        const biMath = document.getElementById('bilateralMath');

        if (bilateralRatings.length > 0) {
            let biCombined = vaCombine([...bilateralRatings]); // Regular combine first
            let boost = biCombined * 0.1;
            let biFinal = biCombined + boost;
            let biRounded = Math.round(biFinal); // VA rounds this intermediate step to nearest whole number

            // Visual Explainer
            biBox.style.display = 'block';
            biMath.innerHTML = `
                <div class="math-step">â€¢ Items in pair: ${bilateralRatings.join('%, ')}%</div>
                <div class="math-step">â€¢ Combined normally: <strong>${biCombined.toFixed(1)}%</strong></div>
                <div class="math-step">â€¢ +10% Boost: <strong>${(biFinal).toFixed(1)}%</strong></div>
                <div class="math-step">â€¢ Rounded for equation: <strong>${biRounded}%</strong></div>
            `;

            // Mix into standard ratings as a single number
            standardRatings.push(biRounded);
        } else {
            biBox.style.display = 'none';
        }

        // 3. Final Combination
        rawScore = vaCombine(standardRatings);
        
        // 4. Rounding
        let rounded = Math.round(rawScore / 10) * 10;
        if (rounded > 100) rounded = 100;

        // 5. Display
        document.getElementById('finalRating').innerText = rounded + "%";
        document.getElementById('rawRating').innerText = `Actual: ${rawScore.toFixed(2)}%`; // Shows exact decimals
        
        let pay = 0;
        if (rounded >= 10) {
            pay = rates.base[rounded];
            if (rounded >= 30) {
                const isMarried = document.getElementById('status').value === 'spouse';
                const kids = parseInt(document.getElementById('children').value) || 0;
                if (isMarried) pay += rates.spouse[rounded];
                if (kids > 0) pay += (kids * rates.child[rounded]);
            }
        }
        document.getElementById('monthlyPay').innerText = "$" + pay.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + " / mo";
    }
</script>

</body>
</html>
